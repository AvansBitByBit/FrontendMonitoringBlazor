@page "/map"
@inject IJSRuntime JS
@using FrontendMonitoring.Models

<div class="mud-paper mud-elevation-3 pa-6 card-animate card-mobile-responsive"
     style="border-radius: 16px; background: var(--mud-palette-surface); min-height: 400px; display: flex; justify-content: center;">
    <div role="group" class="d-flex flex-column gap-4" style="width: 100%; max-width: 1000px;">
        <div role="group" class="d-flex flex-row align-center gap-2">
            <MudIcon Icon="@Icons.Material.Filled.Map" Color="Color.Primary" Style="font-size: 1.5rem;" />
            <MudText Typo="Typo.h6" Style="font-weight: 600;">Locatiekaart</MudText>
        </div>

        <div class="mud-paper mud-elevation-2"
             style="border-radius: 12px; overflow: hidden; background-color: #2a2833;">
            <div id="map" style="height: 500px; width: 60vw; margin: auto; position: relative; background-color: lime; border: 5px solid red;"></div>
        </div>
    </div>
</div>

@code {
    private readonly List<MapDataPoint> mapData = new List<MapDataPoint>
    {
        new MapDataPoint { Lat = 51.5893, Lng = 4.7750, Type = "Plastic" },
        new MapDataPoint { Lat = 51.5910, Lng = 4.7740, Type = "Glass" },
        new MapDataPoint { Lat = 51.5925, Lng = 4.7765, Type = "Paper" }
    };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await JS.InvokeVoidAsync("initLeafletMap", mapData);
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error invoking JS: {ex.Message}");
            }
        }
    }
}
