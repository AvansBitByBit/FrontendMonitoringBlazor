@page "/predictions"
@using MudBlazor
@using FrontendMonitoring.Services
@inject PythonPredictionApiClient PredictionApiClient
@inject ISnackbar Snackbar

<PageTitle>Predictions</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="pa-4">
    <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 12px;">
        <MudStack Spacing="3">
            <MudText Typo="Typo.h5" Style="font-weight: 600;">Make a Prediction</MudText>
            <MudNumericField @bind-Value="temperature"
                             Label="Temperature (Â°C)"
                             Variant="Variant.Outlined"
                             Min="-50" Max="50"
                             Style="width: 200px;" />
            <MudButton Variant="Variant.Filled"
                       Color="Color.Primary"
                       OnClick="MakePrediction"
                       StartIcon="@Icons.Material.Filled.Send"
                       Disabled="isLoading">
                @if (isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                    <span style="margin-left: 8px;">Sending...</span>
                }
                else
                {
                    <span>Send Prediction</span>
                }
            </MudButton>
            @if (response != null)
            {
                <MudAlert Severity="Severity.Success" Variant="Variant.Filled">
                    <MudText Typo="Typo.body1">Predicted Address: @response.AdresPrediction</MudText>
                    <MudText Typo="Typo.body1">Possible Litter Count: @response.CountOfPossibleLitter</MudText>
                    <MudText Typo="Typo.body1">Match With Model: @response.MatchWithModel:F2%</MudText>
                    <MudText Typo="Typo.body1">Confidence: @response.Confidence:F2%</MudText>
                    <MudText Typo="Typo.body1">Timestamp: @response.Timestamp</MudText>
                </MudAlert>
            }
        </MudStack>
    </MudPaper>
</MudContainer>

@code {
    private double temperature = 20.0; // Default temperature
    private bool isLoading = false;
    private PredictionResponse? response;

    private async Task MakePrediction()
    {
        isLoading = true;
        try
        {
            var request = new PredictionRequest { Features = new List<double> { temperature } };
            response = await PredictionApiClient.MakePredictionAsync(request);

            if (response != null)
            {
                Snackbar.Add("Prediction received successfully!", Severity.Success);
            }
            else
            {
                Snackbar.Add("Failed to get a response from the API.", Severity.Warning);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            isLoading = false;
        }
    }
}